<!DOCTYPE html>
<html>
<meta charset="utf-8" />
<link rel="stylesheet" href="../css/company_style/company_style.css" />
<link href="https://cdn.jsdelivr.net/npm/boxicons@2.0.5/css/boxicons.min.css" rel="stylesheet" />
<link rel="shortcut icon" href="../assets/logo/Remo-icon.ico" type="image/x-icon" />
<!--===== bootstrap cdn =====-->
<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/css/bootstrap.min.css" rel="stylesheet"
  integrity="sha384-EVSTQN3/azprG1Anm3QDgpJLIm9Nao0Yz1ztcQTwFspd3yD65VohhpuuCOmLASjC" crossorigin="anonymous" />
<script src="https://cdnjs.cloudflare.com/ajax/libs/crypto-js/4.1.1/crypto-js.min.js"
  integrity="sha512-E8QSvWZ0eCLGk4km3hxSsNmGWbLtSCSUcewDQPQWZF6pEU8GlT8a5fF32wOl1i8ftdMhssTrF/OhyGWwonTcXA=="
  crossorigin="anonymous" referrerpolicy="no-referrer"></script>
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.8.2/font/bootstrap-icons.css" />

<!-- tagify css cdn -->
<link href="https://unpkg.com/@yaireo/tagify/dist/tagify.css" rel="stylesheet" type="text/css" />
<title>Create Job</title>

<body>
  <div class="container-fluid row align-items-center justify-content-center ms-0 me-0 ps-0 pe-0">
    <span class="main-box col col-sm-9 col-md-7 col-lg-5 col-xxl-3.2">
      <!-- CREATE JOB BOX -->
      <section class="form registered pt-3 pb-3" id="login-in">
        <h4 class="title text-center">Create New Job</h4>

        <!--Job Title-->
        <div class="box ms-0 me-0 input-group flex-nowrap">
          <span class="input-group-text" id="addon-wrapping">
            <i class="bx bx-briefcase icon"></i></span>
          <input required type="text" id="jobtitle" name="jobtitle" placeholder="Job Title"
            class="input form-control" />
        </div>

        <!--Job Description-->
        <div class="box ms-0 me-0 input-group flex-nowrap">
          <span class="input-group-text" id="addon-wrapping">
            <i class="bx bx-detail icon"></i></span>
          <textarea required type="text" id="description" name="description" placeholder="Job Description"
            class="input form-control" rows="5" wrap="hard" spellcheck="true"></textarea>
        </div>
        <!--Job Responsibilities  -->
        <div class="box ms-0 me-0 input-group flex-nowrap">
          <span class="input-group-text" id="addon-wrapping">
            <i class="bx bx-task icon"></i></span>
          <textarea required type="text" id="responsibilities" name="responsibilities" placeholder="Responsibilities"
            class="input form-control" rows="5" wrap="hard" spellcheck="true"></textarea>
        </div>
        <!--Salary-->
        <div class="box ms-0 me-0 input-group flex-nowrap">
          <span class="input-group-text" id="addon-wrapping">
            <i class="bx bx-money icon"></i></span>
          <input required type="number" id="salary" name="salary" placeholder="Salary(per month)"
            class="input form-control" />
        </div>

        <!--Preferred Skills-->
        <div class="box ms-0 me-0 input-group flex-nowrap">
          <span class="input-group-text" id="addon-wrapping">
            <i class="bx bx-task icon"></i></span>
          <input required type="text" id="Skills" name="Skills" placeholder="Preferred Skills"
            class="input form-control" wrap="hard" name='tag' spellcheck="true" />
        </div>

        <!--Post Job Button-->
        <div class="d-grid gap-2 col-6 mx-auto">
          <button type="submit" id="post-job-button" class="btn text-white">
            Post Job
          </button>
        </div>
      </section>
    </span>
  </div>

  <!--Firebase Libraries-->

  <script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/9.12.1/firebase-app.js";
    import { getDatabase } from "https://www.gstatic.com/firebasejs/9.12.1/firebase-database.js";
    import {
      getAuth,
      GoogleAuthProvider,
      signInWithPopup,
      createUserWithEmailAndPassword,
      signInWithEmailAndPassword,
      sendPasswordResetEmail,
      onAuthStateChanged,
    } from "https://www.gstatic.com/firebasejs/9.12.1/firebase-auth.js";
    import {
      ref,
      set,
      update,
      child,
      get,
      onValue,
      push,
      onChildAdded,
    } from "https://www.gstatic.com/firebasejs/9.12.1/firebase-database.js";

    // this is credentials
    const firebaseApp = initializeApp({
      apiKey: "AIzaSyC8G9Wf5tJE-GAiI5dLsmn4lCDGmKjxey8",
      authDomain: "remostart-daf09.firebaseapp.com",
      databaseURL: "https://remostart-daf09-default-rtdb.firebaseio.com",
      projectId: "remostart-daf09",
      storageBucket: "remostart-daf09.appspot.com",
      messagingSenderId: "1072762916132",
      appId: "1:1072762916132:web:99d06258e6ea16ba4437b1",
    });
    const database = getDatabase(firebaseApp);
    const auth = getAuth(firebaseApp);
    const dbRef = ref(getDatabase());
    // signUP function
    var postJobButton = document
      .getElementById("post-job-button")
      .addEventListener("click", (e) => {
        var url_string = window.location;
        var url = new URL(url_string);

        var Jobtitle,
          // Joblocation,
          // SelectJobType,
          Salary,
          Description,
          JobResponsibilites,
          Skills;

        Jobtitle = document.getElementById("jobtitle").value;
        JobResponsibilites = document.getElementById("responsibilities").value;
        // SelectJobType = document.getElementById("select-job-type").value;
        Salary = document.getElementById("salary").value;
        Description = document.getElementById("description").value;
        Skills = document.getElementById("Skills").value;

        auth.onAuthStateChanged((user) => {
          if (user) {
            get(child(dbRef, "Company/" + user.uid)).then((snapshot) => {
              if (snapshot.exists()) {
                var Company_name, Company_website, Company_description;
                Company_name = snapshot.val().CompanyName;
                Company_website = snapshot.val().CompanyWebsite;
                Company_description = snapshot.val().CompanyDescripition;

                push(ref(database, "Jobs/"), {
                  CreatedBy: user.uid,
                  CompanyName: Company_name,
                  CompanyWebsite: Company_website,
                  CompanyDescripition: Company_description,
                  Jobtitle: Jobtitle,
                  Salary:Salary,
                  Responsibilities:JobResponsibilites,
                  // Joblocation: Joblocation,
                  // JobType: SelectJobType,
                  Description: Description,
                  Qualification: Skills,
                });
                const tempRef = ref(database, "Jobs/");
                let job = "";
                onChildAdded(tempRef, (data) => {
                  job = data.key;
                });

                const jobid = job;
                alert("Registered Successfully", "success", "login-up");

                push(ref(database, "Company/" + user.uid + "/CreatedJobs/"), {
                  JobID: jobid,
                });
                window.location = "../company/company_dashboard.html";
              } else {
                console.log("Does not work");
              }
            });
          }
        });
      });
  </script>
  
  <script src="https://unpkg.com/@yaireo/tagify"></script>
  <script src="https://unpkg.com/@yaireo/tagify@3.1.0/dist/tagify.polyfills.min.js"></script>
  <script src="../js/company_postjob/company_postjob.js"></script>
</body>

</html>
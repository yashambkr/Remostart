<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <!-- ===== CSS ===== -->
  <link rel="stylesheet" href="../css/Signup_page_css/SignUpPage.css" />

  <!-- ===== BOX ICONS ===== -->
  <link href="https://cdn.jsdelivr.net/npm/boxicons@2.0.5/css/boxicons.min.css" rel="stylesheet" />
  <link rel="shortcut icon" href="../assets/logo/Remo-icon.ico" type="image/x-icon" />
  <!--===== bootstrap cdn =====-->
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/css/bootstrap.min.css" rel="stylesheet"
    integrity="sha384-EVSTQN3/azprG1Anm3QDgpJLIm9Nao0Yz1ztcQTwFspd3yD65VohhpuuCOmLASjC" crossorigin="anonymous" />
  <script src="https://cdnjs.cloudflare.com/ajax/libs/crypto-js/4.1.1/crypto-js.min.js"
    integrity="sha512-E8QSvWZ0eCLGk4km3hxSsNmGWbLtSCSUcewDQPQWZF6pEU8GlT8a5fF32wOl1i8ftdMhssTrF/OhyGWwonTcXA=="
    crossorigin="anonymous" referrerpolicy="no-referrer"></script>

  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.8.2/font/bootstrap-icons.css">

  <title>RemoStart | Login</title>
</head>

<body>
  <div class="container-fluid row align-items-center justify-content-center ms-0 me-0 ps-0 pe-0">
    <div class="main-box col col-sm-9 col-md-7 col-lg-5 col-xxl-3">
      <!-- SIGN IN BOX -->

      <section class="form registered pt-3 pb-3" id="login-in">
        <h3 class="title">Sign In</h3>

        <div class="box ms-0 me-0 input-group flex-nowrap">
          <span class="input-group-text" id="addon-wrapping">
            <i class="bx bx-user icon"></i></span>
          <input required type="text" id="Email-in" name="Email-in" placeholder="Email" class="input form-control" />
        </div>

        <div class="ms-0 me-0 box input-group flex-nowrap">
          <span class="input-group-text" id="addon-wrapping">
            <i class="bx bx-lock-alt icon"></i></span>

          <input required id="password-signin" type="password" name="password" placeholder="Password " minlength="4"
            required class="input form-control mb-0" />


          <label class="input-group-text" for="inputGroupSelect02" style="background-color: white;">
            <i class="bi bi-eye" id="showPassword"></i>
            <i class="bi bi-eye-slash" id="hidePassword" style="display: none;"></i>
          </label>
        </div>
        <div>
          <input required type="checkbox" name="rememberMe" value="Y" /> Remember me
        </div>
        <div>
          <a href="#" class="forgot" id="forgot-button">Forgot password?</a>
        </div>
        <div class="d-grid gap-2 col-6 mx-auto">
          <button type="submit" id="signinbtn" class="btn text-white">
            Sign In
          </button>
        </div>
        <!-- <h3 class="pb-3 mb-0">Or</h3>
        <div class="text-center d-grid gap-2 col-6 mx-auto">
          <a class="btn text-white" role="button">
            <i class="bi bi-google"> </i>Login with Google

          </a>
        </div> -->
        <div class="text-center">
          <span class="account">Don't have an Account ?</span>
          <span class="signup" id="sign-up">Sign Up</span>
        </div>
      </section>

      <!-- SIGN UP BOX -->
      <section class="form create none pt-3 pb-3" id="login-up">
        <h3 class="title">Create Account</h3>

        <div class="namebox">
          <div class="box input-group flex-nowrap ms-0 me-2">
            <span class="input-group-text" id="addon-wrapping">
              <i class="bx bx-user icon"></i>
            </span>

            <input required type="text" placeholder="First name" class="input form-control" id="Fname" name="fname" />
          </div>
          <div class="box input-group flex-nowrap ms-0 me-0">
            <span class="input-group-text" id="addon-wrapping">
              <i class="bx bx-user icon"></i>
            </span>
            <input required type="text" placeholder="Last name" class="input form-control" id="Lname" name="lname" />
          </div>
        </div>

        <div class="box input-group flex-nowrap ms-0 me-0">
          <span class="input-group-text" id="addon-wrapping">
            <i class="bx bx-at icon"></i>
          </span>
          <input required type="text" placeholder="Email" class="input form-control" id="email" name="email" />
        </div>
        <div class="box input-group flex-nowrap ms-0 me-0">
          <span class="input-group-text" id="addon-wrapping">
            <i class="bx bx-phone-call icon"></i>
          </span>

          <input required type="text" placeholder="Phone" class="input form-control" id="phone" name="phone" />
        </div>

        <div class="box input-group flex-nowrap ms-0 me-0">
          <span class="input-group-text" id="addon-wrapping">
            <i class="bx bx-lock-alt icon"></i>
          </span>
          <input required type="password" minlength="6" placeholder="Password" class="input form-control" id="password"
            name="password" />
        </div>
        <div class="box input-group flex-nowrap ms-0 me-0">
          <span class="input-group-text" id="addon-wrapping">
            <i class="bx bx-lock-alt icon"></i>
          </span>
          <input required type="password" minlength="6" placeholder="Re - Type Password" class="input form-control"
            id="password-signup2" name="Password2" />
        </div>
        <div class="d-grid gap-2 col-6 mx-auto">
          <button type="submit" id="sumbitbtn" class="btn text-white">
            Sign Up
          </button>
        </div>
        <!-- <h3 class="pb-3 mb-0">Or</h3>
        <div class="text-center d-grid gap-2 col-6 mx-auto">
          <a class="btn text-white" role="button" style="text-transform:none">
            <img width="20px" style="margin-bottom:3px; margin-right:5px" alt="Google sign-in"
              src="https://upload.wikimedia.org/wikipedia/commons/thumb/5/53/Google_%22G%22_Logo.svg/512px-Google_%22G%22_Logo.svg.png" />
            Sign up with Google
          </a>
        </div> -->
        <div class="text-center">
          <span class="account">Already have an Account ?</span>
          <a class="signup" id="sign-in">Sign In</a>
        </div>
      </section>

      <!-- FORGOT PASSWORD PAGE -->
      <section action="" class="form create none" id="forget-password">
        <h3 class="title">Forgot Password</h3>
        <div class="box input-group ms-0 me-0">
          <input required type="text" id="reset-email" placeholder="Enter your email" class="input form-control"
            id="Forgot_email" name="email" />
        </div>
        <div class="d-grid gap-2 col-6 mx-auto">
          <button type="submit" id="resetbtn" class="btn text-white">
            Reset Password
          </button>
        </div>
      </section>
    </div>
  </div>




  <script src="../js/signup_page_js/SignUpPage.js"></script>
  <!--===== BOOTSTRAP .JS =====-->
  <script src="https://cdn.jsdelivr.net/npm/@popperjs/core@2.9.2/dist/umd/popper.min.js"
    integrity="sha384-IQsoLXl5PILFhosVNubq5LC7Qb9DXgDA9i+tQ8Zj3iwWAwPtgFTxbJ8NT4GN1R8p"
    crossorigin="anonymous"></script>
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/js/bootstrap.bundle.min.js"
    integrity="sha384-MrcW6ZMFYlzcLA8Nl+NtUVF0sA7MsXsP1UyJoMp4YLEuNSfAP+JcXn/tWtIaxVXM"
    crossorigin="anonymous"></script>

  <!-- jqeuy -->
  <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.6.0/jquery.min.js"></script>

  <!--Firebase Libraries-->

  <script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/9.6.10/firebase-app.js";
    import { getDatabase } from "https://www.gstatic.com/firebasejs/9.6.10/firebase-database.js";
    import {
      getAuth, GoogleAuthProvider, signInWithPopup,
      createUserWithEmailAndPassword,
      signInWithEmailAndPassword, sendPasswordResetEmail, onAuthStateChanged
    } from "https://www.gstatic.com/firebasejs/9.6.10/firebase-auth.js";
    import {
      ref,
      set,
      child,
      get,
      onValue,
    } from "https://www.gstatic.com/firebasejs/9.6.10/firebase-database.js";

    // this is credentials 
    const firebaseApp = initializeApp({
      apiKey: "AIzaSyC8G9Wf5tJE-GAiI5dLsmn4lCDGmKjxey8",
      authDomain: "remostart-daf09.firebaseapp.com",
      projectId: "remostart-daf09",
      storageBucket: "remostart-daf09.appspot.com",
      messagingSenderId: "1072762916132",
      appId: "1:1072762916132:web:99d06258e6ea16ba4437b1",
    });
    const database = getDatabase(firebaseApp);
    const auth = getAuth(firebaseApp);

    // signUP function
    var sumbitbtn = document
      .getElementById("sumbitbtn")
      .addEventListener("click", (e) => {
        var Fname, Lname, Email, PhoneNo, password1, password2, Username;

        Fname = document.getElementById("Fname").value;
        Lname = document.getElementById("Lname").value;
        PhoneNo = document.getElementById("phone").value;

        Email = document.getElementById("email").value;
        password1 = document.getElementById("password").value;
        password2 = document.getElementById("password-signup2").value;
        if (password1 === password2) {
          createUserWithEmailAndPassword(auth, Email, password1)
            .then((userCredential) => {
              const user = userCredential.user;
              set(ref(database, "User/" + user.uid), {
                FirstName: Fname,
                LastName: Lname,
                Email: Email,
                PhoneNo: PhoneNo,
              });
              alert("Registered Successfully", "success", "login-up");
              setTimeout(function () {
                window.location = "../SignupPage/SignUpPage.html";
              }, 2000);
            })
            .catch((error) => {
              const errorCode = error.code;
              const errorMessage = error.message;
              alert(errorCode, "warning", "login-up");
            });
        } else {
          alert("password not matched", "warning", "login-up");
        }

      });

    // signIN function
    var signinbtn = document
      .getElementById("signinbtn")
      .addEventListener("click", (e) => {
        var Email = document.getElementById("Email-in").value;
        var password = document.getElementById("password-signin").value;

        signInWithEmailAndPassword(auth, Email, password)
          .then((userCredential) => {
            const user = userCredential.user;
            window.location = "../DashboardPage/DashboardPage.html";
          })
          .catch((error) => {
            const errorCode = error.code;
            const errorMessage = error.message;
            alert(errorCode.slice(5), "warning", "login-in");
            // using slice because it is returing auth/invalid-username,etc .......so we are slicing {auth} part from string
          });
      });




    //  forgot password function

    var resetPassword = document.getElementById("resetbtn").addEventListener("click", (e) => {


      var email = document.getElementById("reset-email").value;


      if (email != "") {

        sendPasswordResetEmail(auth, email)
          .then(() => {
            // Password reset email sent!
            alert("Password reset link has been sent to your email", "success", "forget-password");


          })
          .catch((error) => {
            const errorCode = error.code;
            const errorMessage = error.message;
            alert(errorCode.slice(5), "danger", "forget-password");
            // ..
          });
      } else {

        alert("please enter your email", "warning", "forget-password");
      }
      document.getElementById("reset-email").value = "";
      // empty the placeholder


    });


    //  timelog function {time spend by user}
    // onAuthStateChanged(auth, (user) => {
    //   const start_time = new Date();
    //   if (user) {

    //   } else {
    //     const end_time = new Date();
    //     const Time_spend =  Math.round((((end_time-start_time) % 86400000) % 3600000) / 60000);

    //     set(ref(database, "User/"+user.uid+"/timelog/"), {
    //             start_session: start_time,
    //             end_session:end_time ,
    //             Time_spent:Time_spend
    //           });

    //   }
    //   });

    // alert function
    function alert(message, type, btnlink) {
      var alertPlaceholder = document.getElementById(btnlink);
      var wrapper = document.createElement("div");
      wrapper.innerHTML =
        '<div class="alert alert-' +
        type +
        ' alert-dismissible" role="alert">' +
        message +
        '<button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button></div>';

      alertPlaceholder.append(wrapper);

      // after 3 sec popup is going to disappear
      setTimeout(() => {
        wrapper.style.display = "none";
      }, 3000);


    }

  </script>

  <!-- toggle_password -->

  <script>
    const showPassword = document.querySelector("#showPassword");
    const password = document.querySelector("#password-signin");
    const hidePassword = document.querySelector("#hidePassword");

    $("#showPassword").mouseover(function () {


      $(this).hide();
      $("#hidePassword").show();

      password.setAttribute("type", "text");

    });
    $("#hidePassword").mouseout(function () {
      $(this).hide();
      $("#showPassword").show();


      password.setAttribute("type", "password");
    });

  </script>



</body>

</html>